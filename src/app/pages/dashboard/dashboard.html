<app-topbar></app-topbar>
<div class="card pt-5">
  <p-table
    class="custom-table m-auto"
    [value]="
      userData$
        | async
        | userSearch : (searchTerm$ | async) ?? '' : filteredRole
        | userSort : selectedSort
    "
    [paginator]="true"
    [rows]="rows"
    [totalRecords]="(totalRecords$ | async) || 0"
    [lazy]="true"
    [(first)]="first"
    (onPageChange)="onPageChange($event)"
  >
    <ng-template #caption>
      <div
        class="flex justify-content-between align-items-center mx-auto mb-6 lg:flex-row flex-column gap-5"
      >
        <h1>All users</h1>

        <ul class="button-group ml-auto lg:ml-0">
          <li class="btns flex align-content-center border-round-md mx-4">
            @for (role of roles; track $index) {
            <div>
              <button
                (click)="applyRoleFilter(role.value)"
                class="btn-g"
                [class.active]="filteredRole === role.value"
              >
                {{ role.label }}
              </button>
            </div>
            }
          </li>
          <li>
            <select [(ngModel)]="selectedSort">
              <option value="">No Sort</option>
              <option *ngFor="let option of sortOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </li>
        </ul>
      </div>
    </ng-template>

    <ng-template pTemplate="header">
      <tr>
        <th>Id</th>
        <th>User Image</th>
        <th>First Name</th>
        <th>Last Name</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user.id }}</td>
        <td>
          <img [src]="user.image" alt="avatar" width="40" class="rounded-full" />
        </td>
        <td>{{ user.firstName }}</td>
        <td>{{ user.lastName }}</td>
        <td>
          <div class="flex justify-center">
            <p-menu
              #menu
              [model]="menuItems[user.id]"
              [popup]="true"
              [style]="{
                'min-width': '150px',
                'font-size': '12px',
                'text-align': 'center',
              }"
              [appendTo]="'body'"
            ></p-menu>

            <button
              pButton
              icon="pi pi-ellipsis-v"
              style="font-size: 1.5rem"
              class="p-button-text p-button-rounded p-button-sm action-button"
              (click)="menu.toggle($event)"
              aria-label="Actions"
            ></button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="footer">
      <tr class="footer">
        <td colspan="6">
          Showing {{ first + 1 }} to {{ lastRecord }} of {{ totalRecords }}

          <ul class="btn-p">
            <li>
              <button class="tabel-btn" (click)="goToPrev()" [disabled]="isFirstPage()">
                < Previous
              </button>
            </li>
            <li>
              <button class="tabel-btn" (click)="goToNext()" [disabled]="isLastPage()">
                Next >
              </button>
            </li>
          </ul>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
